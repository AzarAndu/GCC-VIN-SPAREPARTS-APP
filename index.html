<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GCC VIN Spareparts Finder</title>
<style>
  body{margin:0;background:#f4f6f9;font-family:Arial;padding:22px;color:#0b2540}
  .wrap{max-width:1100px;margin:auto}
  table{width:100%;border-collapse:collapse;background:#fff;border-radius:10px;overflow:hidden}
  thead th{background:#eef4fb;padding:10px;text-align:left;font-size:14px}
  tbody td{padding:10px;border-bottom:1px solid #f0f3f7;font-size:14px}
  .btn{background:#0ea5ff;color:#fff;padding:8px 12px;border-radius:8px;border:none;cursor:pointer}
  #search{padding:8px;width:100%;margin-bottom:12px;border-radius:8px;border:1px solid #ccd8e5}
  .linkbtn{padding:6px 10px;background:#2563eb;color:#fff;text-decoration:none;border-radius:6px;font-weight:600}
</style>
</head>

<body>
<div class="wrap">
  <h2>GCC VIN Spareparts Finder</h2>
  <input id="search" type="search" placeholder="Search brand, model or VIN..." />

  <table>
    <thead>
      <tr>
        <th>Brand</th>
        <th>Model</th>
        <th>VIN</th>
        <th>Open</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
</div>

<script>
// RAW CSV URL (your file)
const CSV_URL = "https://raw.githubusercontent.com/AzarAndu/GCC-VIN-SPAREPARTS-APP/main/data.csv";

let MASTER = [];

// Load CSV from GitHub
async function loadCSV(){
  const res = await fetch(CSV_URL);
  const text = await res.text();
  parseCSV(text);
  renderTable(MASTER);
}

// Parse CSV string to objects
function parseCSV(text){
  const lines = text.split(/\r?\n/).filter(l=>l.trim());
  MASTER = lines.map(line=>{
    const parts = line.split(",");
    return {
      brand: parts[0]?.trim() || "",
      model: parts[1]?.trim() || "",
      vin: parts[2]?.trim() || ""
    };
  });
}

// Render table
function renderTable(rows){
  const tb = document.getElementById("tableBody");
  tb.innerHTML = "";
  rows.forEach(r=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${r.brand}</td>
      <td>${r.model}</td>
      <td>${r.vin}</td>
      <td>
        ${r.vin ? `<a class="linkbtn" target="_blank" href="https://partsouq.com/en/search/all?q=${r.vin}">OPEN</a>` : ""}
      </td>
    `;
    tb.appendChild(tr);
  });
}

// Search box filter
document.getElementById("search").addEventListener("input", e=>{
  const q = e.target.value.toLowerCase();
  const filtered = MASTER.filter(r=>
    (r.brand+" "+r.model+" "+r.vin).toLowerCase().includes(q)
  );
  renderTable(filtered);
});

// Start app
loadCSV();
</script>
</body>
</html>
